AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'CAMMI - Serverless Application orchestrator Python 3.13 runtime, 15-minute
  Lambda timeout, feature-based structure.

  '
Globals:
  Function:
    Runtime: python3.13
    Timeout: 900
    MemorySize: 128
    Architectures:
    - x86_64
    Tracing: Active
Resources:
  DynamoDBStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: DynamoDBStack\template.yaml
    Metadata:
      SamResourceId: DynamoDBStack
  GoogleLibrariesLayerStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: GoogleLibrariesLayerStack\template.yaml
    Metadata:
      SamResourceId: GoogleLibrariesLayerStack
  S3Stack:
    Type: AWS::Serverless::Application
    Properties:
      Location: S3Stack\template.yaml
    Metadata:
      SamResourceId: S3Stack
  FeedbackFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - DynamoDBStack
    Properties:
      Location: FeedbackFeature\template.yaml
    Metadata:
      SamResourceId: FeedbackFeature
  AuthFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - DynamoDBStack
    - GoogleLibrariesLayerStack
    Properties:
      Location: AuthFeature\template.yaml
    Metadata:
      SamResourceId: AuthFeature
  OnboardingFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - DynamoDBStack
    Properties:
      Location: OnboardingFeature\template.yaml
    Metadata:
      SamResourceId: OnboardingFeature
  ProjectOrganizationFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - DynamoDBStack
    Properties:
      Location: ProjectOrganizationFeature\template.yaml
    Metadata:
      SamResourceId: ProjectOrganizationFeature
  ApiGatewayFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - FeedbackFeature
    Properties:
      Location: ApiGatewayFeature\template.yaml
    Metadata:
      SamResourceId: ApiGatewayFeature
  BrandSetupFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - S3Stack
    Properties:
      Location: BrandSetupFeature\template.yaml
      Parameters:
        S3BucketName:
          Fn::GetAtt:
          - S3Stack
          - Outputs.CammiBucketName
    Metadata:
      SamResourceId: BrandSetupFeature
  AdminPortalFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - DynamoDBStack
    Properties:
      Location: AdminPortalFeature\template.yaml
    Metadata:
      SamResourceId: AdminPortalFeature
  PaymentGatewayFeature:
    Type: AWS::Serverless::Application
    DependsOn:
    - DynamoDBStack
    Properties:
      Location: PaymentGatewayFeature\template.yaml
    Metadata:
      SamResourceId: PaymentGatewayFeature
Outputs:
  DynamoDBStackOutput:
    Description: Outputs from nested DynamoDB stack
    Value:
      Ref: DynamoDBStack
  GoogleLibrariesLayerStackOutput:
    Description: Outputs from Google libraries layer stack
    Value:
      Ref: GoogleLibrariesLayerStack
  S3StackOutput:
    Description: Outputs from Cammi S3 stack
    Value:
      Ref: S3Stack
  FeedbackFeatureOutput:
    Description: Outputs from Feedback feature stack
    Value:
      Ref: FeedbackFeature
  AuthFeatureOutput:
    Description: Outputs from Auth feature stack
    Value:
      Ref: AuthFeature
  onboardingFeatureOutput:
    Description: Outputs from onboarding feature stack
    Value:
      Ref: OnboardingFeature
  ProjectOrganizationFeatureOutput:
    Description: Outputs from project-organization feature stack
    Value:
      Ref: ProjectOrganizationFeature
  AdminPortalFeatureOutput:
    Description: Outputs from the admin portal feature stack
    Value:
      Ref: AdminPortalFeature
  PaymentGatewayFeatureOutput:
    Description: Outputs from the payment gateway feature stack
    Value:
      Ref: PaymentGatewayFeature
